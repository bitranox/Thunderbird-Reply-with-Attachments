---
id: usage
title: 'Использование'
sidebar_label: 'Использование'
---

---

## Использование {#usage}

- Ответьте, и дополнение добавит оригиналы автоматически — или сначала спросит, если это включено в Параметрах.
- Исключение дубликатов по имени файла; части S/MIME всегда пропускаются. Встроенные изображения по умолчанию восстанавливаются в теле ответа (отключается параметром «Include inline pictures» в Параметрах).
- Вложения из черного списка также пропускаются (регистронезависимые glob‑шаблоны, сопоставляемые с именами файлов, а не путями). См. [Конфигурация](configuration#blacklist-glob-patterns).

---

### Что происходит при ответе {#what-happens}

- Обнаружить ответ → перечислить исходные вложения → отфильтровать S/MIME + inline → при необходимости запросить подтверждение → добавить подходящие файлы (пропустить дубликаты) → восстановить встроенные изображения в теле.

Строгий vs. упрощенный проход: дополнение сначала исключает части S/MIME и inline из файловых вложений. Если ничего не подходит, выполняется упрощенный проход, который по‑прежнему исключает S/MIME/inline, но допускает больше случаев (см. детали кода). Встроенные изображения никогда не добавляются как файловые вложения; вместо этого, когда включен параметр «Include inline pictures» (по умолчанию), они встраиваются непосредственно в тело ответа как URI данных base64.

| Тип части                                                           |                     Строгий проход |                  Упрощенный проход |
| ------------------------------------------------------------------- | ---------------------------------: | ---------------------------------: |
| Файл подписи S/MIME `smime.p7s`                                     |                          Исключено |                          Исключено |
| Типы MIME S/MIME (`application/pkcs7-*`)                            |                          Исключено |                          Исключено |
| Встроенное изображение, на которое ссылается Content‑ID (`image/*`) | Исключено (восстановлено в теле\*) | Исключено (восстановлено в теле\*) |
| Вложенное письмо (`message/rfc822`) с именем файла                  |                     Не добавляется |               Может быть добавлено |
| Обычное файловое вложение с именем файла                            |               Может быть добавлено |               Может быть добавлено |

\* Когда «Include inline pictures» включен (по умолчанию: ON), встроенные изображения встраиваются в тело ответа как URI данных base64 вместо добавления их как файловых вложений. См. [Конфигурация](configuration#include-inline-pictures).

Пример: У некоторых вложений могут отсутствовать определенные заголовки, но они все же являются обычными файлами (не inline/S/MIME). Если строгий проход не находит ни одного, упрощенный проход может принять такие и прикрепить их.

---

### Перекрестные ссылки {#cross-reference}

- Пересылка намеренно не изменяется (см. Ограничения ниже).
- Причины, по которым вложение может не быть добавлено, см. в разделе «Почему вложения могут не добавляться».

---

## Подробности поведения {#behavior-details}

- **Предотвращение дубликатов:** дополнение помечает вкладку создания письма как обработанную с помощью сессионного значения на вкладку и защиты в памяти. Оно не добавит оригиналы дважды.
- Закрытие и повторное открытие окна создания письма рассматривается как новая вкладка (т. е. разрешается новая попытка).
- **Учет существующих вложений:** если в черновике уже есть какие‑то вложения, оригиналы все равно добавляются ровно один раз, пропуская уже имеющиеся имена файлов.
- **Исключения:** артефакты S/MIME и встроенные изображения исключаются из файловых вложений. Если при первом проходе ничто не подходит, упрощенный резервный режим повторно проверяет части, не относящиеся к S/MIME. Встроенные изображения обрабатываются отдельно: они восстанавливаются в теле ответа как URI данных (если включено).
  - **Имена файлов:** `smime.p7s`
  - **Типы MIME:** `application/pkcs7-signature`, `application/x-pkcs7-signature`, `application/pkcs7-mime`
  - **Встроенные изображения:** любая часть `image/*`, на которую ссылается Content‑ID — исключается из файловых вложений, но встраивается в тело ответа, когда «Include inline pictures» включен
  - **Вложенные письма (`message/rfc822`):** рассматриваются как обычные вложения, если у них есть имя файла; они могут быть добавлены (с учетом проверки дубликатов и черного списка).
- **Предупреждение о черном списке (если включено):** когда кандидаты исключаются вашим черным списком,
  дополнение показывает небольшое модальное окно со списком затронутых файлов и соответствующих
  шаблонов. Это предупреждение также появляется в случаях, когда вложения не будут
  добавлены, потому что все было исключено.

---

## Сочетания клавиш {#keyboard-shortcuts}

- Диалог подтверждения: Y/J = Yes, N/Esc = No; Tab/Shift+Tab и стрелки по кругу переключают фокус.
  - Параметр «Default answer» в [Конфигурация](configuration#confirmation) задает кнопку, сфокусированную изначально.
  - Enter активирует сфокусированную кнопку. Tab/Shift+Tab и стрелки перемещают фокус для удобства доступа.

### Шпаргалка по клавишам {#keyboard-cheat-sheet}

| Клавиши            | Действие                            |
| ------------------ | ----------------------------------- |
| Y / J              | Подтвердить Да                      |
| N / Esc            | Подтвердить Нет                     |
| Enter              | Активировать выбранную кнопку       |
| Tab / Shift+Tab    | Переместить фокус вперед/назад      |
| Стрелки            | Переместить фокус между кнопками    |
| Ответ по умолчанию | Задает начальный фокус (Да или Нет) |

---

## Ограничения {#limitations}

- Пересылка этим дополнением не изменяется (поддерживаются Ответить и Ответить всем).
- Очень большие вложения могут подпадать под ограничения Thunderbird или провайдера.
  - Дополнение не разбивает и не сжимает файлы; оно полагается на стандартную обработку вложений Thunderbird.
- Зашифрованные сообщения: части S/MIME намеренно исключаются.

---

## Почему вложения могут не добавляться {#why-attachments-might-not-be-added}

- Встроенные изображения не добавляются как файловые вложения. Когда «Include inline pictures» включен (по умолчанию), они встраиваются в тело ответа как URI данных. Если параметр выключен, встроенные изображения удаляются полностью. См. [Конфигурация](configuration#include-inline-pictures).
- Части с подписями S/MIME исключаются по задумке: имена файлов вроде `smime.p7s` и типы MIME, такие как `application/pkcs7-signature` или `application/pkcs7-mime`, пропускаются.
- Шаблоны черного списка могут отфильтровывать кандидатов: см. [Конфигурация](configuration#blacklist-glob-patterns); сопоставление регистронезависимое и только по имени файла.
- Дубликаты имен файлов не добавляются повторно: если в черновике уже есть файл с тем же нормализованным именем, он пропускается.
- Нефайловые части или отсутствие имен файлов: к добавлению рассматриваются только похожие на файлы части с пригодными именами.

---

См. также

- [Конфигурация](configuration)
